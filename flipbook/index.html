<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline PDF Flipbook</title>

<style>
  body {
    margin: 0;
    background: #2b2b2b;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  #viewerWrapper {
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #flipbook {
    background: transparent;
  }

  .page {
    background: #fff;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  #prevBtn, #nextBtn {
    position: fixed;
    top: 10%;
    padding: 12px 18px;
    font-size: 16px;
    cursor: pointer;
    background: #fff;
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,.4);
    z-index: 1000;
  }

  #prevBtn { left: 20px; }
  #nextBtn { right: 20px; }
</style>
</head>

<body>

<div id="viewerWrapper">
  <div id="flipbook"></div>
</div>

<button id="prevBtn">◀ Prev</button>
<button id="nextBtn">Next ▶</button>

<!-- Offline Libraries -->
<script src="libs/jquery.min.js"></script>
<script src="libs/pdf.js"></script>
<script src="libs/turn.min.js"></script>

<script>
const PDF_URL = 'pdf/book.pdf';

const flipbook = $('#flipbook');
let pdfDoc = null;
let pageAspect = 1;

pdfjsLib.GlobalWorkerOptions.workerSrc = 'libs/pdf.worker.js';

function isPortrait() {
  return window.innerHeight > window.innerWidth;
}

function computeLayout() {
  const height = window.innerHeight * 0.96; // FULL HEIGHT
  let width;

  if (isPortrait()) {
    width = height * pageAspect;
    return { width, height, display: 'single' };
  } else {
    width = height * pageAspect * 2;
    return { width, height, display: 'double' };
  }
}

function initTurn(layout) {
  if (flipbook.data('turn')) {
    flipbook.turn('destroy');
  }

  flipbook.turn({
    width: layout.width,
    height: layout.height,
    display: layout.display,
    autoCenter: true,
    duration: 600,
    gradients: true,
    acceleration: true
  });
}

pdfjsLib.getDocument(PDF_URL).promise.then(async pdf => {
  pdfDoc = pdf;

  const firstPage = await pdf.getPage(1);
  const viewport = firstPage.getViewport({ scale: 1 });
  pageAspect = viewport.width / viewport.height;

  for (let i = 1; i <= pdf.numPages; i++) {
    const pageDiv = document.createElement('div');
    pageDiv.className = 'page';

    const canvas = document.createElement('canvas');
    pageDiv.appendChild(canvas);
    flipbook.append(pageDiv);

    pdf.getPage(i).then(page => {
      const scale = window.devicePixelRatio * 2;
      const vp = page.getViewport({ scale });

      canvas.width = vp.width;
      canvas.height = vp.height;

      page.render({
        canvasContext: canvas.getContext('2d'),
        viewport: vp
      });
    });
  }

  if (flipbook.children().length % 2 !== 0) {
    flipbook.append('<div class="page"></div>');
  }

  initTurn(computeLayout());
});

window.addEventListener('resize', () => {
  if (!pdfDoc) return;
  initTurn(computeLayout());
});

document.getElementById('prevBtn').onclick = () => flipbook.turn('previous');
document.getElementById('nextBtn').onclick = () => flipbook.turn('next');

window.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') flipbook.turn('previous');
  if (e.key === 'ArrowRight') flipbook.turn('next');
});
</script>

</body>
</html>
