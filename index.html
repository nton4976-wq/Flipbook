<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Offline PDF Flipbook — Single Page View</title>

<style>
  :root{
    --bg: #121217;
    --card: #0f1720;
    --accent: #06b6d4;
    --muted: rgba(255,255,255,0.65);
    --gap: 18px;
    --pad: 18px;
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    background:linear-gradient(180deg,var(--bg) 0%, #0b0b0d 100%);
    color:#fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .stage{
    width:100vw;
    height:100vh;
    padding:0;
    box-sizing:border-box;
    display:flex;
    align-items:stretch;
    justify-content:stretch;
  }

  /* The card that holds the flipbook */
  .viewer-card{
    flex:1 1 auto;
    display:flex;
    align-items:center;
    justify-content:center;
    background: #000;
    border-radius:0;
    padding:0;
    box-shadow:none;
    position:relative;
    overflow:hidden;
  }

  /* Flipbook container (turn.js requires a wrapper element) */
  #flipbook{
    background:transparent;
    border-radius:10px;
    overflow:visible;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .page{
    background:#fff;
    border-radius:8px;
    box-shadow: 0 8px 20px rgba(2,6,23,0.45);
    overflow:hidden;
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  canvas{display:block; width:100%; height:100%;}

  /* Controls */
  .control{
    position: absolute;
    top:50%;
    transform:translateY(-50%);
    background: rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
    padding:14px 12px;
    border-radius:10px;
    backdrop-filter: blur(6px);
    cursor:pointer;
    user-select:none;
  }
  #prevBtn{left:12px}
  #nextBtn{right:12px}
  .control:hover{background:rgba(255,255,255,0.08); color:#fff}

  .topbar{
    position:absolute;
    left:var(--pad);
    right:var(--pad);
    top:var(--pad);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    pointer-events:none;
  }
  .topbar .label{pointer-events:auto}

  .page-indicator{
    font-size:13px;
    color:var(--muted);
    background:rgba(0,0,0,0.25);
    padding:6px 10px;
    border-radius:8px;
    backdrop-filter:blur(6px);
  }

  .loader{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }

  .meta{display:none}

  /* Responsive tweaks */
  @media (max-width:900px){
    .stage{padding:14px}
    .meta{display:none}
    .control{padding:10px}
  }

</style>
</head>
<body>

<div class="stage">
  <div class="viewer-card" id="viewer">
    <!-- PDF chooser overlay -->
    <div id="chooser" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#000;z-index:20;">
      <div style="text-align:center;max-width:420px;width:90%;">
        <h2 style="margin:0 0 12px;font-weight:600;">Select a PDF</h2>
        <p style="margin:0 0 16px;color:rgba(255,255,255,.7);font-size:14px;">Choose a PDF from the <code>pdf/</code> folder</p>
        <select id="pdfSelect" style="width:100%;padding:12px;border-radius:8px;border:none;font-size:15px;">
          <option value="">-- Select PDF --</option>
        </select>
        <div style="margin-top:14px;font-size:12px;color:rgba(255,255,255,.6);">Tip: add files to the <code>pdf</code> folder and list them below</div>
      </div>
    </div>
    <div class="topbar">
      <div class="label page-indicator" id="pageIndicator">Loading...</div>
      <div class="label" id="fileLabel">book.pdf</div>
    </div>

    <div id="flipbook"></div>

    <button class="control" id="prevBtn" aria-label="Previous page">◀</button>
    <button class="control" id="nextBtn" aria-label="Next page">▶</button>

    <div class="loader" id="loader" aria-hidden="true">Rendering pages…</div>
  </div>

  <!-- Optional side meta column (hidden on narrow screens) -->
  <aside class="meta" aria-hidden="true">
    <div style="font-weight:600;color:#fff;">Flipbook controls</div>
    <div>Use ◀ ▶ or ← → keys to navigate. Pinch/zoom and double-click are supported by some browsers.</div>
    <div style="font-size:13px;color:var(--muted);">Rendered at device pixel ratio for crisp text.</div>
  </aside>
</div>

<!-- Offline libraries (keep these offline files in libs/) -->
<script src="libs/jquery.min.js"></script>
<script src="libs/pdf.js"></script>
<script src="libs/turn.min.js"></script>

<script>
// === CONFIG ===
// Manually list PDFs in the /pdf folder (offline-safe)
const PDF_LIST = [
  'pdf/CED.pdf'
];

let PDF_URL = null; // selected at runtime
const flipbook = $('#flipbook');
let pdfDoc = null;
let pageAspect = 1;
let currentPage = 1;

// Tell pdfjs where its worker is located (relative path)
pdfjsLib.GlobalWorkerOptions.workerSrc = 'libs/pdf.worker.js';

// Populate selector
const select = document.getElementById('pdfSelect');
PDF_LIST.forEach(p => {
  const opt = document.createElement('option');
  opt.value = p;
  opt.textContent = p.split('/').pop();
  select.appendChild(opt);
});

select.addEventListener('change', e => {
  if (e.target.value) loadPDF(e.target.value);
});

function computeFit(maxW, maxH) {
  // FULL-SCREEN priority: use full height, scale width by aspect
  const targetH = maxH;
  const targetW = targetH * pageAspect;

  // If width exceeds container, fallback to width-based fit
  if (targetW > maxW) {
    const w = maxW;
    const h = w / pageAspect;
    return { w: Math.round(w), h: Math.round(h) };
  }
  return { w: Math.round(targetW), h: Math.round(targetH) };
}

function initTurn(width, height) {
  // Destroy if already inited
  if (flipbook.data('turn')) flipbook.turn('destroy');

  flipbook.css({width: width + 'px', height: height + 'px'});
  flipbook.turn({
    width, height,
    autoCenter: true,
    display: 'single', // ALWAYS single page view
    duration: 500,
    gradients: true,
    acceleration: true
  });
}

function updateIndicator() {
  $('#pageIndicator').text(currentPage + ' / ' + (pdfDoc ? pdfDoc.numPages : '?'));
}

async function renderAllPages() {
  $('#loader').show();
  flipbook.empty();

  const viewport1 = (await pdfDoc.getPage(1)).getViewport({scale:1});
  pageAspect = viewport1.width / viewport1.height;

  // compute available space inside viewer card (with small padding)
  const card = document.getElementById('viewer');
  const style = getComputedStyle(card);
  const pad = 0; // FULL SCREEN – no inner padding // internal padding
  const maxW = card.clientWidth;
  const maxH = card.clientHeight;
  const fit = computeFit(maxW, maxH);

  // Render each page into a canvas sized for the computed fit (but high DPI)
  for (let i = 1; i <= pdfDoc.numPages; i++){
    const page = await pdfDoc.getPage(i);

    const wrapper = document.createElement('div');
    wrapper.className = 'page';
    wrapper.style.width = fit.w + 'px';
    wrapper.style.height = fit.h + 'px';

    const canvas = document.createElement('canvas');
    canvas.style.width = fit.w + 'px';
    canvas.style.height = fit.h + 'px';

    const context = canvas.getContext('2d');

    // choose a render scale so the canvas has enough device pixels
    const devicePR = window.devicePixelRatio || 1;
    const viewport = page.getViewport({scale:1});
    const scale = (fit.w * devicePR) / viewport.width;
    const vp = page.getViewport({scale});

    canvas.width = Math.round(vp.width);
    canvas.height = Math.round(vp.height);

    // white bg for PDF page
    context.fillStyle = '#ffffff';
    context.fillRect(0,0,canvas.width,canvas.height);

    await page.render({canvasContext: context, viewport: vp}).promise;

    wrapper.appendChild(canvas);
    flipbook.append(wrapper);
  }

  // Ensure even number of pages for turn.js
  if (flipbook.children().length % 2 !== 0) {
    const blank = document.createElement('div');
    blank.className = 'page';
    blank.style.width = fit.w + 'px';
    blank.style.height = fit.h + 'px';
    flipbook.append(blank);
  }

  initTurn(fit.w, fit.h);
  $('#loader').hide();
  updateIndicator();
}

// Load the PDF (called after selection)
async function loadPDF(url){
  PDF_URL = url;
  $('#fileLabel').text(url.split('/').pop());
  $('#chooser').hide();
  $('#loader').show();

  try{
    pdfDoc = await pdfjsLib.getDocument(url).promise;
    await renderAllPages();
    currentPage = 1;
    flipbook.turn('page', currentPage);
  }catch(err){
    $('#loader').text('Failed to load PDF');
    console.error(err);
  }
}


// Navigation
$('#prevBtn').on('click', () => {
  flipbook.turn('previous');
});
$('#nextBtn').on('click', () => {
  flipbook.turn('next');
});

// Keyboard nav
window.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') flipbook.turn('previous');
  if (e.key === 'ArrowRight') flipbook.turn('next');
});

// Update current page index when flipping
flipbook.on('turned', function(e, page) {
  currentPage = page;
  updateIndicator();
});

// Re-render on resize (debounced)
let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    if (!pdfDoc) return;
    renderAllPages();
  }, 220);
});

</script>
</body>
</html>









